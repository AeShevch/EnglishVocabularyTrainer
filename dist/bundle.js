(()=>{"use strict";const t=(t,e)=>t.sort((()=>Math.random()-Math.random())).slice(0,e);class e{constructor(){this.element=null,this.listeners=new Set,this.rerender=this.rerender.bind(this)}getElement(){return this.element||(this.element=(t=>{const e=document.createElement("div");return e.innerHTML=t,e.firstElementChild})(this.getTemplate())),this.element}unmount(){var t;this.clearHandlers(),null===(t=this.element)||void 0===t||t.remove(),this.element=null}setHandler({type:t,handler:e,elementSelector:n}){this.saveHandler({type:t,handler:e,elementSelector:n});const s=this.getElement();let i=s;if(n){const t=s.querySelector(n);t&&(i=t)}i.addEventListener(t,e)}clearHandlers(){this.listeners.forEach((({elementSelector:t,handler:e,type:n})=>{var s;null===(s=document.querySelector(t))||void 0===s||s.removeEventListener(n,e)}))}saveHandler(t){this.listeners.add(t)}rerender(){const t=this.getElement();this.element=null;const e=this.getElement();t.replaceWith(e),this.restoreListeners()}restoreListeners(){Array.from(this.listeners).forEach((t=>{this.setHandler(t),this.listeners.delete(t)}))}}class n extends e{getTemplate(){return(({questions:e,currentQuestionIdx:n,maxMistakesCount:s})=>{const i=n+1,{letters:r,currentLetterIdx:o,mistakesCount:a,completed:l}=e[n],u=l?r:r.slice(0,o),d=l?[]:r.slice(o,r.length),h=t(d,d.length);return`\n    <div>\n      <p class="mb-1">\n        Question \n        <span id="current_question">${i}</span> \n          of \n        <span id="total_questions">${e.length}</span>\n      </p>\n      <p class="mb-5">\n        Mistakes \n        <span>${a}</span> \n          of \n        <span>${s}</span>\n      </p>\n      <div class="d-inline-flex flex-column">\n        <div id="answer" class="d-inline-flex justify-content-center bg-light mx-1 mb-3 row gx-2" style="height: 46px; border-radius: 6px">\n         ${u.map((t=>`<div class="col-auto">\n                    <div class="btn btn-primary ${a===s?"btn-danger":""}">\n                       ${t}\n                    </div>\n                 </div>\n                `)).join("")}\n          </div>\n          <div id="letters">\n            <div class="container px-4">\n              <div class="js-answer-buttons row gx-2">\n                ${h.map((t=>`<div class="col-auto">\n                          <button type="button" class="js-letter-button btn btn-primary">\n                             ${t}\n                          </button>\n                       </div>\n                      `)).join("")}\n              </div>\n          </div>\n      </div>\n    </div>\n`})(this.props)}setProps(t){this.props=t}}class s extends e{getTemplate(){return'<div>\n    <button autofocus type="button" class="js-start-training btn btn-primary">\n      Start training\n    </button> \n   </div>\n'}}class i extends e{getTemplate(){return(({maxMistakes:t,mistakesCount:e,withoutMistakesCount:n})=>{const s=t.map((({word:t})=>t)).join(", ");return`\n        <div>\n          <ul class="list-group mb-3">\n            <li class="list-group-item gx-3 row d-flex justify-content-between align-items-center">\n              <span class="col-auto text-start text-nowrap">Without mistakes:</span>\n              <span class="col-auto badge bg-primary rounded-pill">${n}</span>\n            </li>\n            <li class="list-group-item gx-3 row d-flex justify-content-between align-items-center">\n              <span class="col-auto text-start text-nowrap">Mistakes:</span>\n              <span class="col-auto badge bg-primary rounded-pill">${e}</span>\n            </li>\n            ${s&&`\n                <li class="list-group-item gx-3 row d-flex justify-content-between align-items-center">\n                  <span class="col-auto text-start text-nowrap"> Maximum number of mistakes:</span>\n                  <span class="col-auto badge bg-primary rounded-pill">${s}</span>\n                </li>\n              `}\n          </ul>\n        \n          <button autofocus type="button" class="js-start-again btn btn-primary">Start again</button>\n        </div>\n  `})(this.props)}setProps(t){this.props=t}}class r extends e{getTemplate(){return'<div id="resume-request-modal" class="modal fade show" style="display: block;background: rgb(71 71 71 / 49%);" tabindex="-1">\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title">Continue the training?</h5>\n        </div>\n        <div class="modal-body text-start">\n          <p>Hey! You didn\'t finish your previous training session.</p>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="js-close-modal btn btn-secondary" data-bs-dismiss="modal">Start again</button>\n          <button type="button" class="js-resume-training btn btn-primary">Resume last training</button>\n        </div>\n      </div>\n    </div>\n  </div>'}}const o=".js-app-root",a="btn-danger",l=(t,e,n="beforeEnd")=>{"afterBegin"===n?t.prepend(e.getElement()):t.append(e.getElement())};new class{constructor(t,e,o){this.setRootNode(),this.model=t,this.storage=o,this.router=e,this.startScreenComponent=new s,this.trainingComponent=new n,this.summaryComponent=new i,this.resumeRequestModalComponent=new r,this.trainingComponent.setProps(this.model),this.renderStartPage=this.renderStartPage.bind(this),this.renderTrainingPage=this.renderTrainingPage.bind(this),this.renderSummaryPage=this.renderSummaryPage.bind(this),this.startAgain=this.startAgain.bind(this),this.keyPressHandler=this.keyPressHandler.bind(this),this.resumeTrainingClickHandler=this.resumeTrainingClickHandler.bind(this),this.closeModalClickHandler=this.closeModalClickHandler.bind(this),this.unmountAllPages=this.unmountAllPages.bind(this),this.router.onBeforePageChange=this.unmountAllPages}run(){const t=this.storage.get();t&&this.showResumeTrainingModal(t),this.router.addRoute("/",this.renderStartPage).addRoute("/training/:slug",(({slug:t})=>this.renderTrainingPage(t)),!0).addRoute("/results",this.renderSummaryPage).start(),this.router.navigateTo("/")}setRootNode(){const t=document.querySelector(o);if(!t)throw new Error(`Root node (${o}) not found!`);this.rootNode=t}setGlobalHandlers(){window.addEventListener("keypress",this.keyPressHandler)}clearGlobalHandlers(){window.removeEventListener("keypress",this.keyPressHandler)}letterClickHandler(t){const e=t.outerText;e&&this.checkLetter(e.trim(),t)}keyPressHandler({key:t}){if(/^[a-zA-Z]$/.test(t)){const e=((t,e)=>Array.from(t.querySelectorAll(".js-letter-button")).find((({textContent:t})=>t&&t.trim()===e)))(this.rootNode,t);this.checkLetter(t,e)}}resumeTrainingClickHandler(t){this.resumeRequestModalComponent.unmount(),this.model.newTraining(t),this.router.navigateTo(`/training/${this.model.currentQuestionIdx+1}`)}closeModalClickHandler(){this.resumeRequestModalComponent.unmount(),this.storage.clear()}renderStartPage(){l(this.rootNode,this.startScreenComponent),this.startScreenComponent.setHandler({type:"click",handler:()=>this.router.navigateTo("/training/1"),elementSelector:".js-start-training"})}renderTrainingPage(t){this.model.currentQuestionIdx=Number(t)-1,l(this.rootNode,this.trainingComponent),this.trainingComponent.setHandler({type:"click",handler:t=>{t.target instanceof HTMLButtonElement&&this.letterClickHandler(t.target)},elementSelector:".js-answer-buttons"}),this.setGlobalHandlers()}renderSummaryPage(){this.storage.clear(),this.summaryComponent.setProps((t=>{const e=t.reduce(((t,{mistakesCount:e})=>t>e?t:e),0);return t.reduce(((t,n)=>({withoutMistakesCount:n.mistakesCount?t.withoutMistakesCount:t.withoutMistakesCount+1,mistakesCount:t.mistakesCount+n.mistakesCount,maxMistakes:n.mistakesCount===e&&0!==e?[...t.maxMistakes,{word:n.letters.join(""),count:e}]:t.maxMistakes})),{withoutMistakesCount:0,mistakesCount:0,maxMistakes:[]})})(this.model.questions)),l(this.rootNode,this.summaryComponent),this.summaryComponent.setHandler({type:"click",handler:this.startAgain,elementSelector:".js-answer-buttons"})}showResumeTrainingModal(t){l(this.rootNode,this.resumeRequestModalComponent),this.resumeRequestModalComponent.setHandler({type:"click",handler:()=>this.resumeTrainingClickHandler(t),elementSelector:".js-resume-training"}),this.resumeRequestModalComponent.setHandler({type:"click",handler:this.closeModalClickHandler,elementSelector:".js-close-modal"})}startAgain(){this.model.newTraining(),this.router.navigateTo("/")}highlightWrongLetter(t){t?(t.classList.add(a),window.setTimeout((()=>{t.classList.remove(a),this.trainingComponent.rerender()}),200)):this.trainingComponent.rerender()}goToNextQuestionWithDelay(){this.nextQuestionTimeoutID||(this.nextQuestionTimeoutID=window.setTimeout((()=>{if(this.nextQuestionTimeoutID=null,!this.model.isLastQuestion())return this.model.nextQuestion(),void this.router.navigateTo(`/training/${this.model.currentQuestionIdx+1}`);this.clearGlobalHandlers(),this.router.navigateTo("/results")}),1500))}checkLetter(t,e){const{isCorrect:n,isCompleted:s}=this.model.inputLetter(t);n?this.trainingComponent.rerender():this.highlightWrongLetter(e),s&&this.goToNextQuestionWithDelay(),this.storage.set(this.model.questions)}unmountAllPages(){this.startScreenComponent.unmount(),this.trainingComponent.unmount(),this.summaryComponent.unmount()}}(new class{constructor(t){if(this.maxMistakesCount=3,!t||!t.length)throw new Error("No words for training given!");this.words=t,this.newTraining(),this.inputLetter=this.inputLetter.bind(this)}newTraining(e){if(e)return this.questions=e,void(this.currentQuestionIdx=e.findIndex((({completed:t})=>!t)));this.currentQuestionIdx=0;const n=t(this.words,3);this.questions=n.map((t=>({letters:t.split(""),currentLetterIdx:0,mistakesCount:0,completed:!1})))}inputLetter(t){let e=!1,n=!1;return this.isCorrectLetter(t)?(this.nextLetter(),e=!0):this.increaseMistakesCount(),(this.isLastMistake()||this.isLastLetter())&&(this.setCurrentQuestionCompleted(),n=!0),{isCorrect:e,isCompleted:n}}nextQuestion(){this.changeQuestion(this.currentQuestionIdx+1)}prevQuestion(){this.changeQuestion(this.currentQuestionIdx-1)}changeQuestion(t){t<0||t>=this.questions.length?console.warn("Wrong step index!"):this.currentQuestionIdx=t}isCorrectLetter(t){const{letters:e,currentLetterIdx:n}=this.questions[this.currentQuestionIdx];return t===e[n]}isLastLetter(){const t=this.questions[this.currentQuestionIdx];return t.currentLetterIdx===t.letters.length}isLastMistake(){return this.questions[this.currentQuestionIdx].mistakesCount===this.maxMistakesCount}isLastQuestion(){return this.currentQuestionIdx===this.questions.length-1}nextLetter(){this.isQuestionCompleted()||(this.questions[this.currentQuestionIdx].currentLetterIdx+=1)}increaseMistakesCount(){this.isQuestionCompleted()||(this.questions[this.currentQuestionIdx].mistakesCount+=1)}setCurrentQuestionCompleted(){this.questions[this.currentQuestionIdx].completed=!0}isQuestionCompleted(){return this.questions[this.currentQuestionIdx].completed}}(["apple","function","timeout","task","application","data","tragedy","sun","symbol","button","software"]),new class{constructor(){this.routes=[],this.onBeforePageChange=null}addRoute(t,e,n=!1){return this.routes.push({path:t,callback:e,isDynamic:n}),this}navigateTo(t){window.history.pushState(null,"",t),this.handleRouteChange(window.location.pathname)}start(){window.addEventListener("popstate",(()=>this.handleRouteChange(window.location.pathname))),this.handleRouteChange(window.location.pathname)}handleRouteChange(t){this.onBeforePageChange&&this.onBeforePageChange(t);for(let e=0;e<this.routes.length;e+=1){const n=this.routes[e];if(n.isDynamic){const e=new RegExp(`^${n.path.replace(/:\w+/g,"([\\w-]+)")}$`),s=t.match(e);if(s){const t=s.slice(1).reduce(((t,e,s)=>Object.assign(Object.assign({},t),{[n.path.split(":")[s+1]]:e})),{});return void n.callback(t)}}else if(n.path===t)return void n.callback()}console.warn(`No route found for ${t}`)}},new class{constructor(t,e=window.localStorage){this.key=t,this.storage=e}set(t){this.storage.setItem(this.key,JSON.stringify(t))}get(){const t=this.storage.getItem(this.key);return t?JSON.parse(t):null}removeItem(){this.storage.removeItem(this.key)}clear(){this.storage.clear()}}("storage")).run()})();